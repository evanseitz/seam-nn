TODO:

- paper:
    - Variability logo metric and make box plot (CLIPNET)
    - Background amplitude vs foreground; stratify by prediction
    - Bg analysis in task 0 vs task 1
    - Kmer spectra on backgrounds - yagi?
    - Redo Fig.2 RHS with SNV and pairwise; then we can say later that pairwise for PIK3R3 was too much
    - Sup fig for covariance matrices (take out of Figure 2)
    - New sup fig from combined Fig. 5 leftovers


- examples
    - both:
        - global on TTK? aAGGA(T/C)AAt
        - global AP-1 needs code for finding all instances of motif from test/train
        - Why is Umap cpu working without pipping
        - for any example with IntGrad, show baseline_type is an option
        - DeepSTARR mismatch figure reproduced (index 22612; Dev)
            - color logos by reference sequence
            - try IntGrad
        - DeepSTARR background separation figure reproduced (test set index 4071; Hk)
        - DeepSTARR 3-way mutation figure reproduced --> test with crop mode
            - AP1-m0-seq13748
            - play GIF showing a chain of k-means clusters
            - compare to SQUID pairwise 
            - repeat all slides from first SCQB presentation
                - splitting modes in function histogram
        - REVO? BEAM?
        - ChromBPNet?
        - PIK3R3?
        - DeepSTARR global analysis with interactive plots --> send to Yagi
            - GIA scores in Compiler
        - direct link to github scripts for examples in README
        - one global example using GIA coloring
        - REVO
        - DeepSHAP with PyTorch? (Captum)
        - Try global using genomic locus with dinuc shuffle?
        - ResidualBind example for global? (see old slide)
            - TEAD vs AP-1: check ENCODE profiles for each TF?
        - Global analyis on procapnet examples (recall figure with profiles)
    - local:
        - example using TF1 --> TF2 workflow
        - Hnf4a UMAP example
        - once global colabs are finished, replicate locally
        - for all local, use DeepSHAP?
        - folder name specification: e.g., "kmeans_k200" for 200 clusters
    - colab:
        - redo local Zfp187 with _ism_gpu (check new _ism_cpu too, and compare log2FC on/off)
        - for all colab, use IntGrad?
        - interactive MSM viewer
        - interactive embedding viewer
        - add note to all about use of IntGrad vs DeepSHAP (in paper)
        - Colab instructions to use GUI, and to download inputs
        - SpliceAI example


- plotting:
    - Missing save outputs:
        - all_maps_average_y_adaptive.png / all_maps_average_y_fixed.png


- SQUID:
    - Mutation window for CombinatorialMutagenesis()?
    - add copies of all colab tutorials (with import versions) to GitHub folder
    - plot_y_hist() in impress.py needs option to set new axvline ref_idx or None
    - handle larger pairwise matrices
    - check why global seed is the only reason x_mut can be preserved
        - add option to input pre-generated x_mut
        - add option to skip inference (y_mut = None) -> is this already in place?

- CLIPNET:
    - Run on PIK3CA: 
        - most commonly mutated proto-oncogene (mutated in 13% of cancers)
        - TERT



Readthedocs:
    - API figure (use squid as template)
    - Check all readthedocs pages for accuracy
    - https://pypi.org/project/seam-nn/ pictures not loading correctly? also check all text


- Attributer:
    - Refactor DeepSHAP code for newer TF versions
    - ISM:
        - ISM with sum or PCA option
        - option for FastISM?
        - add memory mode for ISM (numpy memmap)
    - Empirical Mutagenesis Maps (for combinatorially-complete library)
    - DeepSHAP for TF2: dinuc_shuffle, etc. in batch mode with GPUs
        - pytorch version?
    - DeepSHAP:
        - no longer need sequence_utils.py?
        - dinuc shuffling vs training set
    - option to use PyTorch instead of TensorFlow and Captum (ProCapNet example)
    - embed Hessian and concat with attribution map?
    - Global tests (CPU/GPU):
        - ism: YES / YES
            - check fastism code: https://github.com/kundajelab/fastISM/blob/master/fastISM/ism_base.py
            - gpu with/without log2fc: _ / _
        - saliency: yes / yes
        - smoothgrad: yes / yes --> check latest revision (in place, untested)
        - intgrad: yes / yes
            - zeros: yes
            - random: NO --> worked for local in examples folder maybe? maybe a gpu problem?
            - dinuc: NO --> see above
        - deepshap: NO / NO
        - empirical that works on GPU?
    - Plot each map within a given int grad trajectory
    - compute(), process_batch(), and compute_attributions() actually necessary?


- Compiler:
    - SEAM utils calls
    - Move hamming distance calculation to SEAM utils?
    - save output to self.mave
    - docstring check (readthedocs compatibility)
    - discover alphabet from mave.csv and save to self.alphabet
        - e.g., alphabet = sorted(list(set(mave['Sequence'][0:100].apply(list).sum())))
    - mave.to_csv('mave.csv', index=False)
    - remove redundant sequences (in general) and after concat with SNV/DNV; or check if it’s already in the code (or put it there in compile)
    - ensembler() to combine model folds?


- Clusterer:
    - implement other methods from cuml.manifold?
        - tsne GPU
        - pca GPU
    - phate GPU?
    - add diffusion maps code
    - higher-dimensional PCA into k-means?
    - reuse DM distance matrix for clustering?
    - add Louvain (or Leiden) clustering
    - PCA: return eigenvalue spectrum


- MetaExplainer:
    - add mutual information plot to explainer?
    - JK: plot KL divergence between cluster and BG (2nd distribution) for coloring MSM?
    - Marginal delta_H to show regions of conservation
    - test plot_cluster_profiles
        - check profile plotting functionality (lines 741-753 from meta_explainer_orig.py)
            - plot individual profiles for each cluster
            - handle alpha blending for overlays
    - check PWMs and enrichment logos
        - PWM bits should be max 2 (not 4)
    - line up the MSM with the logos below them, and with the bar plot to their right (see below)
    - use marginal bar plots on the right side of the MSM figure
    - background_entropy currently only defined for 4 nucleotides; see latex equation


- Identifier:
    - code to combine TFBS states based on squares in covariance matrix
        - use more complicated locus: Ohler6-m0-seq171
    - Fisher, Binomial, etc. for SNPs database
    - update readthedocs for Identifier
    - add xtick_spacing to plot_covariance_square
    - background_entropy currently only defined for 4 nucleotides
    - calculate expected effect for each cluster? (change in y-value from WT cluster)
    - fix state matrix bug (multiplier > 1?)


- Impress:
    - move all plotting code to impress.py?
        - plot_dendrogram
        - minimize other redundancies between functions in identifier.py and clusterer.py
        - etc.


- GUI Class:
    - update for latest repository
        - new logomaker (remove old logo versions)
    - if adaptive logos not pre-generated, automatically show fixed
    - PWM bits are not correct (should be max 2, not 4)
    - MSM window: boxplots of y values in margin or separate window
    - P1: if no manifold, n/a plots on P2 and P3
    - Save a page of individual logos to figure from a given cluster (popup window with start/stop option)
    - if no points selected, clear and show warning box
    - P2: “adaptive” and “fixed”
    - P2/P3: statistics window needs correct toolbar readouts
    - P1: “First row”, “consensus”, “custom”, “None”
    - All axes: just show 0,25,50,75,100%
    - Redoing cluster folder on P1 (while hist shown on P2) results in overlapping plots on P2
    - Drop duplicates
    - Put {attribution method} (e.g., DeepSHAP) in all /clusters filenames
    - Box plots for y vs clusters in MSM margin or sub-window
    - P3 logos still vertically squished
    - Disable dark mode
    - Re-assert “Drawing order” after changing “Color Map” on P2
    - Toolbars: save with tight layout
    - Go to WT cluster (i.e., first row of ‘all clusters.csv’)
    - Check accuracy of delta H calculation (error?)
    - Plot_clusters_matches_2d_gui:
        - Impress: delta=True in GUI; alphabet; “r” (mutation rate)
    - GUI marginal window needs “Entropy difference” option
    - P2: button to save indices of encircled points (and print)
    - P2: show occupancy of encircled region in toolbar
    - GUI crash on P3 for UMAP and hierarchical logos
    - Slightly larger black points on P3 of GUI
    - MSM: option to map SEAM coordinates to new number (e.g., chr1:A-B)
    - P3: resize logo as window is made larger
    - Save mismatch table in Marginal Window of GUI; popup window showing location of saved file
    - Option to rank MSM by median y value (if pre-sort is not selected)
    - “Show boxplots” button
    - P3: up and down toggle arrows for “choose cluster”
    - P3: render and save logo on the fly (if missing)
    - Ability to switch between hierarchical cut levels on the fly
    - For public release, make sure all examples have all logos (fixed, etc.)
    - Update P3 UMAP when Custom.plt_step is changed on P2 (needs to update Predef.cluster_colors)
    - New tab to merge clusters and label them (e.g., AP-1, etc)
        - Visualize state vs. TFBS presence graph


- Biophysical modeling:
    - DRE-m0-seq601


- Other:
    - Discussion: 
        - augment libraries with:
            - all SNVs, pairwise, (higher order?)
            - a collection of known population variants
            - indels
            - sliding
        - impute missing values from experimental datasets
    - backup SEAM Colabs on github
    - backup SQUID Colabs on github
    - SQUID replicates update
    - Yagi's data workflow and GUI
    - SEAM remaining figures
    - 'ward' vs other linkages
    - use all_maps_average to prove a point?
    - intgrad zeros vs intgrad dinuc --> same appearance with cluster average?
        - compare to average over all maps in library; smoothGrad comparison, etc.
    - PCA with more dims
    - Hessian or PW vs purely additive
        - or pairwise directly using PBM
    - need to say CREB is 15 flanks; DRE is 10 flanks?
    - Other figures:
        - PPIF enhancer (cropped)
            - cropped and hierarchical
            - compare to Enformer (e.g., cl.36 vs cl.186)
                - compare backgrounds
        - compare backgrounds across different attribution methods
        - Fig. 1 schematic example
            - compare to SQUID pairwise
            - compare to average of all maps in library (and smoothgrad)
        - intra-cluster variability logo for highest occupancy cluster
    - Figure revisions:
        - Illustrator attribution y-axes in Myriad: change to Arial, and add middle notch



- Motif finding:
    - best attribution method?
    - best num_seqs, mut_rate? (1000 seems sufficient)
    - best cut_level?
        - attribution clusters
        - TFBS clusters
    - poised?


- Sharing:
    - Danko Lab
    - Carlos (work on protein dataset)
    - ...


- Future SEAM studies:
	- protein compartments (PLM dataset)
    - Zoopedia evolutionary data
    - Other Stark lab DNN with more output heads
        - show different backgrounds for each task?


- Zenodo
    - update colab downloads
    - add all downloaded files:
        - Zfp187_2626_contig8mers.txt
        - Hnf4...